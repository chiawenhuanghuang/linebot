<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>LIFF 表單測試</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.0.0/jquery.min.js"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>
</head>
<body>
    <div class="row" style="margin: 10px">
        <div class="col-12" style="margin: 10px">
            <label>換宿類別</label>
            <select id="sel_room_type" class="form-control">
                <option selected disabled hidden>請選擇換宿類別</option>
                <option>校內學士班宿舍</option>
                <option>校內研究生宿舍</option>
                <option>BOT太子學舍</option>
            </select>
            <br />
            <label>現住宿舍類別</label>
            <select id="now_room" class="form-control">
                <option selected disabled hidden>請選擇現住宿舍類別</option>
                <option>校內學士班宿舍</option>
                <option>校內研究生宿舍</option>
                <option>BOT太子學舍</option>
            </select>
            <br />
            <label>現住宿舍</label><br>
            <select id="now_room_s" class="form-control">
                <option selected disabled hidden>請選擇現住宿舍</option>
                <option>男一舍</option>
                <option>男二舍</option>
                <option>男三舍</option>
                <option>男四舍</option>
                <option>男五舍</option>
                <option>男六舍</option>
                <option>男七舍</option>
                <option>男八舍</option>

                <option>女一舍</option>
                <option>女二舍</option>
                <option>女三舍</option>
                <option>女四舍</option>
                <option>女五舍</option>
                <option>女六舍</option>
                <option>女八舍</option>
                <option>女九舍</option>

                <option>研一男舍</option>
                <option>研一女舍</option>
                <option>研三舍</option>
                <option>大一女舍</option>
            </select>
        
            <br />
            <label>現住樓層或房號（可不填）</label>
            <input type="text" id="now_room_floor" class="form-control"/>
            <br />
            <label>想換到的宿舍</label>
            <select id="sel_room" class="form-control" multiple="true">
                <option selected disabled hidden>請選擇換宿類別</option>
                <option>男一舍</option>
                <option>男二舍</option>
                <option>男三舍</option>
                <option>男四舍</option>
                <option>男五舍</option>
                <option>男六舍</option>
                <option>男七舍</option>
                <option>男八舍</option>

                <option>女一舍</option>
                <option>女二舍</option>
                <option>女三舍</option>
                <option>女四舍</option>
                <option>女五舍</option>
                <option>女六舍</option>
                <option>女八舍</option>
                <option>女九舍</option>

                <option>研一男舍</option>
                <option>研一女舍</option>
                <option>研三舍</option>
                <option>大一女舍</option>
            </select>
            <br />
            <label>想換到的樓層或房號(可不填)</label>
            <input type="text" id="sel_room_type" class="form-control" />
            <br />
            <label>聯絡方式(請留一種方式就好，以免個資外洩) </label>
            <input type="text" id="contact" class="form-control" />
            <br />
            <br />

            <label>特殊需求：希望換到的宿舍...（可不填）</label>
            <select id="roommate" multiple="true">
                <option selected disabled hidden></option>
                <option>室友安靜</option>
                <option>室友較早就寢（12點以前）</option>
                <option>室友不要打呼</option>
                <option>室友不要太淺眠</option>
                <option>室友乾淨</option>
            </select>
            <br />
            <br />
            <button class="btn btn-success btn-block" id="sure">確定</button>
        </div>
    </div>
    <script language="Javascript">
        document.getElementById('sel_room').onclick = function() {  
        var markedCheckbox = document.querySelectorAll('input[type="checkbox"]:checked');  
        for (var checkbox of markedCheckbox) {  
            var psel_room = checkbox.value;
            }  
        }  
    </script>

    <script src="https://static.line-scdn.net/liff/edge/2.1/sdk.js"></script>
	<script>
        function initializeLiff(myLiffId) {
            liff.init({liffId: myLiffId });
        }

		function pushMsg(psel_room_type, pnow_room, pnow_room_s, pnow_room_floor, psel_room, psel_room_type, pcontact, proommate) {
			if (psel_room_type == '' || pnow_room == '' || pnow_room_s == ''|| psel_room == ''|| pcontact == '') {  //資料檢查
				alert('尚有必填資料未填寫！');
			 	return;
			}
			var msg = "###";  //回傳訊息字串
			msg = msg + psel_room_type + "/";
			msg = msg + pnow_room + "/";
            msg = msg + pnow_room_s+ "/";
			msg = msg + pnow_room_floor + "/";
            msg = msg + psel_room + "/";
            msg = msg + psel_room_type + "/";
            msg = msg + pcontact + "/";
            msg = msg + proommate;

			liff.sendMessages([  //推播訊息
				{ type: 'text',
				  text: msg
				}
			])
				.then(() => {
					liff.closeWindow();  //關閉視窗
				});
		}

		$(document).ready(function () {
			initializeLiff('{{ liffid }}');  //接收傳遞的 liffid 參數
			$('#sure').click(function (e) {  //按下確定鈕
				pushMsg($('#sel_room_type').val(), $('#now_room').val(), $('#now_room_s').val(), $('#now_room_floor').val(), $('#sel_room').val(), $('#sel_room_type').val(), $('#contact').val(), $('#roommate').val());
			});
		});
	</script>
</body>
</html>